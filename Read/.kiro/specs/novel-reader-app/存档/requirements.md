# 需求文档

## 简介

本项目是一个面向Android平台的智能小说阅读器应用。该应用不仅提供基础的本地小说阅读功能，还创新性地集成了网站小说解析、AI章节摘要生成、等特色功能，旨在为用户提供便捷、智能、个性化的阅读体验。

## 术语表

- **应用（Application）**：指本Android小说阅读器应用程序
- **用户（User）**：使用本应用阅读小说的人
- **小说（Novel）**：用户导入或解析的文学作品
- **章节（Chapter）**：小说的组成部分，包含标题和正文内容
- **书架（Bookshelf）**：应用中用于管理和展示用户小说集合的界面
- **解析引擎（Parser Engine）**：用于从网站提取小说内容的模块
- **解析规则（Parser Rule）**：定义如何从特定网站提取章节列表和正文的配置
- **AI服务（AI Service）**：第三方大语言模型API服务，用于生成章节摘要
- **TTS引擎（Text-to-Speech Engine）**：将文字转换为语音的系统组件
- **本地存储（Local Storage）**：应用在设备上保存数据的数据库系统
- **阅读器（Reader）**：显示小说正文内容的界面组件
- **阅读进度（Reading Progress）**：用户在某本小说中的当前阅读位置
- **书签（Bookmark）**：用户标记的特定章节位置

## 需求

### 需求 1：本地小说导入

**用户故事：** 作为用户，我想要导入本地小说文件，以便我可以在应用中阅读已有的小说资源。

#### 验收标准

1. WHEN 用户选择导入本地文件 THEN 应用 SHALL 显示文件选择器界面
2. WHEN 用户选择TXT格式文件 THEN 应用 SHALL 解析文件内容并创建小说条目
3. WHEN 用户选择EPUB格式文件 THEN 应用 SHALL 解析EPUB结构并提取章节信息
4. WHEN 导入过程中发生错误（如文件损坏、格式不支持） THEN 应用 SHALL 显示明确的错误提示信息
5. WHEN 导入成功完成 THEN 应用 SHALL 将小说添加到书架并显示成功提示

### 需求 2：网站小说解析

**用户故事：** 作为用户，我想要通过输入网站URL来导入网络小说，以便我可以阅读在线小说资源而无需手动复制粘贴。

#### 验收标准

1. WHEN 用户输入小说网站URL THEN 应用 SHALL 验证URL格式的有效性
2. WHEN URL有效 THEN 解析引擎 SHALL 访问该网页并提取小说元数据（标题、作者、简介）
3. WHEN 解析引擎识别章节列表 THEN 应用 SHALL 提取所有章节的标题和链接
4. WHEN 用户选择下载章节 THEN 应用 SHALL 按顺序获取每个章节的正文内容
5. WHEN 解析过程中遇到网络错误 THEN 应用 SHALL 支持断点续传功能
6. WHEN 网页内容包含广告或无关元素 THEN 解析引擎 SHALL 过滤这些内容仅保留正文
7. WHEN 解析完成 THEN 应用 SHALL 将小说保存到本地存储并添加到书架

### 需求 3：自定义解析规则

**用户故事：** 作为用户，我想要配置不同网站的解析规则，以便应用能够支持更多小说网站。

#### 验收标准

1. WHEN 用户访问解析规则管理界面 THEN 应用 SHALL 显示已有规则列表
2. WHEN 用户创建新规则 THEN 应用 SHALL 提供输入字段用于配置网站域名、章节列表选择器、正文选择器
3. WHEN 用户保存规则 THEN 应用 SHALL 验证规则配置的完整性
4. WHEN 规则配置不完整 THEN 应用 SHALL 阻止保存并提示缺失的字段
5. WHEN 用户测试规则 THEN 应用 SHALL 使用该规则解析示例URL并显示提取结果
6. WHEN 用户删除规则 THEN 应用 SHALL 从系统中移除该规则配置

### 需求 4：书架管理

**用户故事：** 作为用户，我想要在书架上管理我的小说集合，以便我可以方便地组织和查找小说。

#### 验收标准

1. WHEN 用户打开书架界面 THEN 应用 SHALL 显示所有已导入小说的列表
2. WHEN 显示小说条目 THEN 应用 SHALL 展示封面、标题、作者、阅读进度信息
3. WHEN 用户长按小说条目 THEN 应用 SHALL 显示操作菜单（删除、编辑信息、置顶）
4. WHEN 用户删除小说 THEN 应用 SHALL 从本地存储中移除该小说及其所有章节数据
5. WHEN 用户搜索小说 THEN 应用 SHALL 根据标题或作者关键词过滤显示结果
6. WHEN 用户按分类筛选 THEN 应用 SHALL 显示符合指定分类的小说

### 需求 5：阅读器功能

**用户故事：** 作为用户，我想要一个功能完善的阅读界面，以便我可以舒适地阅读小说内容。

#### 验收标准

1. WHEN 用户打开小说 THEN 阅读器 SHALL 显示上次阅读位置的章节内容
2. WHEN 用户滑动屏幕 THEN 阅读器 SHALL 支持上下滚动翻页
3. WHEN 用户点击屏幕中央 THEN 阅读器 SHALL 显示或隐藏顶部和底部工具栏
4. WHEN 用户调整字体大小 THEN 阅读器 SHALL 立即应用新的字体大小设置
5. WHEN 用户调整行间距 THEN 阅读器 SHALL 立即应用新的行间距设置
6. WHEN 用户切换章节 THEN 阅读器 SHALL 加载新章节内容并更新阅读进度
7. WHEN 用户退出阅读 THEN 应用 SHALL 自动保存当前阅读位置

### 需求 6：主题和显示设置

**用户故事：** 作为用户，我想要自定义阅读界面的外观，以便在不同环境下获得最佳阅读体验。

#### 验收标准

1. WHEN 用户访问主题设置 THEN 应用 SHALL 提供至少三种预设主题（日间、夜间、护眼）
2. WHEN 用户选择主题 THEN 阅读器 SHALL 立即应用该主题的背景色和文字色
3. WHEN 用户自定义背景色 THEN 应用 SHALL 允许用户从调色板选择任意颜色
4. WHEN 用户自定义文字色 THEN 应用 SHALL 允许用户从调色板选择任意颜色
5. WHEN 用户保存自定义主题 THEN 应用 SHALL 将该主题添加到主题列表
6. WHEN 系统时间进入夜间时段 THEN 应用 SHALL 自动切换到夜间模式（如果用户启用了自动切换）

### 需求 7：书签功能

**用户故事：** 作为用户，我想要添加和管理书签，以便我可以快速返回到重要的章节位置。

#### 验收标准

1. WHEN 用户在阅读时点击添加书签按钮 THEN 应用 SHALL 保存当前章节和段落位置
2. WHEN 添加书签 THEN 应用 SHALL 允许用户为书签添加备注文字
3. WHEN 用户查看书签列表 THEN 应用 SHALL 显示所有书签及其章节标题、位置和备注
4. WHEN 用户点击书签条目 THEN 阅读器 SHALL 跳转到该书签对应的位置
5. WHEN 用户删除书签 THEN 应用 SHALL 从本地存储中移除该书签记录

### 需求 8：AI章节摘要

**用户故事：** 作为用户，我想要查看章节的AI生成摘要，以便我可以快速了解章节内容或回顾之前的情节。

#### 验收标准

1. WHEN 用户请求生成章节摘要 THEN 应用 SHALL 调用AI服务API并传递章节文本
2. WHEN AI服务返回摘要内容 THEN 应用 SHALL 显示摘要文字并保存到本地存储
3. WHEN AI服务调用失败 THEN 应用 SHALL 显示错误提示并允许用户重试
4. WHEN 章节已有缓存的摘要 THEN 应用 SHALL 直接显示缓存内容而不重复调用API
5. WHEN 用户批量生成摘要 THEN 应用 SHALL 按顺序处理多个章节并显示进度
6. WHEN API调用超时 THEN 应用 SHALL 在30秒后终止请求并提示用户

### 需求 9：关键词搜索

**用户故事：** 作为用户，我想要在小说中搜索关键词，以便我可以快速找到包含特定内容的章节位置并进行跳转。

#### 验收标准

1. WHEN 用户在阅读界面打开搜索功能 THEN 应用 SHALL 显示搜索输入框
2. WHEN 用户输入关键词并执行搜索 THEN 应用 SHALL 在当前小说的所有章节中查找该关键词
3. WHEN 搜索完成 THEN 应用 SHALL 显示包含该关键词的所有位置列表（章节名称、段落预览）
4. WHEN 用户点击搜索结果条目 THEN 阅读器 SHALL 跳转到该关键词所在位置并高亮显示
5. WHEN 用户在搜索结果页面点击返回 THEN 阅读器 SHALL 恢复到搜索前的原始阅读进度
6. WHEN 搜索无结果 THEN 应用 SHALL 显示"未找到相关内容"的提示信息
7. WHEN 用户在搜索结果间切换 THEN 应用 SHALL 支持上一个、下一个结果的快速导航

### 需求 10：语音朗读

**用户故事：** 作为用户，我想要使用语音朗读功能，以便我可以在不方便看屏幕时收听小说内容。

#### 验收标准

1. WHEN 用户启动语音朗读 THEN 应用 SHALL 使用TTS引擎朗读当前章节内容
2. WHEN 朗读进行中 THEN 应用 SHALL 显示播放控制界面（播放、暂停、停止）
3. WHEN 用户调整朗读速度 THEN TTS引擎 SHALL 立即应用新的语速设置
4. WHEN 用户选择朗读音色 THEN TTS引擎 SHALL 切换到指定的语音引擎
5. WHEN 当前章节朗读完成 THEN 应用 SHALL 自动开始朗读下一章节
6. WHEN 用户暂停朗读 THEN 应用 SHALL 保存当前朗读位置
7. WHEN 用户恢复朗读 THEN 应用 SHALL 从暂停位置继续朗读

### 需求 11：屏蔽词管理

**用户故事：** 作为用户，我想要设置屏蔽词，以便在阅读时自动过滤或替换不想看到的词汇。

#### 验收标准

1. WHEN 用户访问屏蔽词管理界面 THEN 应用 SHALL 显示当前已设置的屏蔽词列表
2. WHEN 用户添加新屏蔽词 THEN 应用 SHALL 将该词保存到本地存储
3. WHEN 用户删除屏蔽词 THEN 应用 SHALL 从本地存储中移除该词
4. WHEN 阅读器显示章节内容 THEN 应用 SHALL 将所有屏蔽词替换为星号或指定字符
5. WHEN 用户修改屏蔽词设置 THEN 阅读器 SHALL 立即刷新当前页面应用新的屏蔽规则
6. WHEN 屏蔽词列表为空 THEN 阅读器 SHALL 显示原始文本内容不进行任何替换

### 需求 12：阅读统计

**用户故事：** 作为用户，我想要查看我的阅读统计数据，以便我可以了解自己的阅读习惯和进度。

#### 验收标准

1. WHEN 用户阅读小说 THEN 应用 SHALL 记录阅读时长到本地存储
2. WHEN 用户查看统计界面 THEN 应用 SHALL 显示总阅读时长、总阅读字数
3. WHEN 显示统计数据 THEN 应用 SHALL 展示每日阅读时长的图表
4. WHEN 显示统计数据 THEN 应用 SHALL 展示最常阅读的时间段分布
5. WHEN 显示统计数据 THEN 应用 SHALL 列出阅读最多的小说排行
6. WHEN 用户切换统计周期（日、周、月） THEN 应用 SHALL 更新显示对应周期的数据

### 需求 13：数据持久化

**用户故事：** 作为用户，我希望我的阅读数据能够可靠保存，以便我不会丢失阅读进度和个人设置。

#### 验收标准

1. WHEN 应用首次启动 THEN 本地存储 SHALL 初始化数据库结构
2. WHEN 用户导入小说 THEN 应用 SHALL 将小说元数据和章节内容保存到数据库
3. WHEN 用户修改阅读进度 THEN 应用 SHALL 立即更新数据库中的进度记录
4. WHEN 用户修改设置 THEN 应用 SHALL 将设置保存到SharedPreferences
5. WHEN 应用异常退出 THEN 本地存储 SHALL 保持数据完整性不发生损坏
6. WHEN 用户清除应用缓存 THEN 应用 SHALL 仅删除临时文件保留核心数据

### 需求 14：网络请求管理

**用户故事：** 作为用户，我希望应用能够高效稳定地处理网络请求，以便我可以顺利导入网络小说和使用AI功能。

#### 验收标准

1. WHEN 应用发起网络请求 THEN 应用 SHALL 检查网络连接状态
2. WHEN 网络不可用 THEN 应用 SHALL 提示用户并取消请求
3. WHEN 网络请求超时 THEN 应用 SHALL 在15秒后终止请求并提示用户
4. WHEN 服务器返回错误状态码 THEN 应用 SHALL 根据状态码显示相应的错误信息
5. WHEN 下载大量章节 THEN 应用 SHALL 使用队列机制控制并发请求数量
6. WHEN 用户取消下载任务 THEN 应用 SHALL 停止所有待处理的请求

