# 实现计划

- [x] 1. 项目初始化和基础架构搭建






  - 配置Gradle依赖（Hilt, Room, Retrofit, RxJava, Jsoup, MPAndroidChart, jqwik）
  - 设置Java 21编译选项和最低SDK 24
  - 创建基础包结构（data, domain, presentation, di, utils）
  - 配置Hilt依赖注入
  - _验证需求：12.1_

- [x] 2. 数据库层实现















  - 创建所有Entity类（NovelEntity, ChapterEntity, BookmarkEntity, ParserRuleEntity, ReadingStatisticsEntity, BlockedWordEntity）
  - 实现所有DAO接口（NovelDao, ChapterDao, BookmarkDao, ParserRuleDao, ReadingStatisticsDao, BlockedWordDao）
  - 创建AppDatabase类并配置Room
  - _验证需求：12.1, 12.2_


- [x] 2.1 编写数据库层属性测试














  - **Property 49: 小说导入数据完整性**
  - **验证需求：12.2**

- [x] 2.2 编写数据库层属性测试










  - **Property 50: 阅读进度更新即时性**
  - **验证需求：12.3**

- [x] 3. 领域模型和数据转换




  - 创建所有领域模型类（Novel, Chapter, Bookmark, ParserRule, SearchResult, ReadingStatistics, BlockedWord）
  - 实现Entity到Domain模型的Mapper类
  - _验证需求：1.2, 1.3, 2.2, 4.2_

- [x] 4. 文件解析服务实现

  - 实现FileParserService接口
  - 实现TXT文件解析逻辑（章节识别、内容提取）
  - 实现EPUB文件解析逻辑（使用EPUB库）
  - 实现文件错误处理
  - _验证需求：1.2, 1.3, 1.4_

- [x] 4.1 编写文件解析属性测试




  - **Property 1: TXT文件解析完整性**
  - **验证需求：1.2**



- [x] 4.2 编写文件解析属性测试

  - **Property 2: EPUB文件章节提取正确性**
  - **验证需求：1.3**


- [x] 4.3 编写文件解析属性测试




  - **Property 3: 文件导入错误处理**
  - **验证需求：1.4**

- [x] 5. 文件导入Repository实现





  - 实现FileImportRepository接口
  - 集成FileParserService
  - 实现文件导入后保存到数据库的逻辑
  - _验证需求：1.2, 1.3, 1.5_

- [x] 5.1 编写文件导入属性测试



  - **Property 4: 导入后书架一致性**
  - **验证需求：1.5**

- [ ] 6. 网站解析引擎实现





  - 实现WebParserService接口
  - 使用Jsoup实现HTML解析
  - 实现元数据提取（标题、作者、简介）
  - 实现章节列表提取
  - 实现章节内容提取和清理
  - 实现广告过滤逻辑
  - _验证需求：2.2, 2.3, 2.6_

- [x] 6.1 编写网站解析属性测试



  - **Property 6: 网页元数据提取完整性**
  - **验证需求：2.2**


- [x] 6.2 编写网站解析属性测试



  - **Property 7: 章节列表提取完整性**
  - **验证需求：2.3**

- [x] 6.3 编写网站解析属性测试



  - **Property 10: 内容过滤正确性**
  - **验证需求：2.6**

- [ ] 7. 网络请求管理实现





  - 配置Retrofit和OkHttp
  - 实现网络连接状态检查
  - 实现超时处理（15秒）
  - 实现错误状态码处理
  - 实现并发请求队列控制
  - _验证需求：13.1, 13.2, 13.3, 13.4, 13.5_

- [x] 7.1 编写网络请求属性测试



  - **Property 54: 网络请求前状态检查**
  - **验证需求：13.1**

- [x] 7.2 编写网络请求属性测试



  - **Property 56: 网络请求超时处理**
  - **验证需求：13.3**

- [x] 7.3 编写网络请求属性测试



  - **Property 58: 并发请求数量限制**
  - **验证需求：13.5**

- [x] 8. WebParserRepository实现





  - 实现WebParserRepository接口
  - 集成WebParserService和网络请求
  - 实现URL验证
  - 实现断点续传功能
  - 实现下载进度回调
  - 实现下载取消功能
  - _验证需求：2.1, 2.4, 2.5, 2.7, 13.6_

- [x] 8.1 编写WebParser属性测试



  - **Property 5: URL格式验证正确性**
  - **验证需求：2.1**

- [x] 8.2 编写WebParser属性测试




  - **Property 8: 章节下载顺序性**
  - **验证需求：2.4**

- [x] 8.3 编写WebParser属性测试



  - **Property 9: 断点续传一致性**
  - **验证需求：2.5**


- [x] 8.4 编写WebParser属性测试



  - **Property 11: 解析后数据持久化**
  - **验证需求：2.7**

- [x] 9. 解析规则管理实现






  - 实现ParserRuleRepository接口
  - 实现规则CRUD操作
  - 实现规则验证逻辑（检查必需字段）
  - 实现规则测试功能
  - _验证需求：3.3, 3.4, 3.5, 3.6_

- [x] 9.1 编写解析规则属性测试



  - **Property 12: 解析规则验证完整性**
  - **验证需求：3.3**

- [x] 9.2 编写解析规则属性测试



  - **Property 13: 不完整规则拒绝**
  - **验证需求：3.4**

- [x] 9.3 编写解析规则属性测试



  - **Property 15: 规则删除一致性**
  - **验证需求：3.6**

- [x] 10. NovelRepository核心功能实现






  - 实现NovelRepository接口
  - 实现小说CRUD操作
  - 实现章节CRUD操作
  - 实现阅读进度管理
  - 实现小说搜索功能
  - 实现分类筛选功能
  - _验证需求：4.4, 4.5, 4.6, 5.1, 5.6, 5.7_

- [x] 10.1 编写NovelRepository属性测试



  - **Property 17: 小说删除级联性**
  - **验证需求：4.4**

- [x] 10.2 编写NovelRepository属性测试



  - **Property 18: 小说搜索准确性**
  - **验证需求：4.5**

- [x] 10.3 编写NovelRepository属性测试



  - **Property 19: 分类筛选准确性**
  - **验证需求：4.6**

- [x] 10.4 编写NovelRepository属性测试


  - **Property 20: 阅读进度恢复正确性**
  - **验证需求：5.1**

- [x] 10.5 编写NovelRepository属性测试


  - **Property 23: 章节切换一致性**
  - **验证需求：5.6**

- [x] 10.6 编写NovelRepository属性测试


  - **Property 24: 阅读位置保存正确性**
  - **验证需求：5.7**

- [x] 11. 关键词搜索功能实现





  - 在NovelRepository中实现searchInNovel方法
  - 实现全文搜索逻辑（在所有章节中查找关键词）
  - 实现搜索结果构建（包含章节信息、位置、预览）
  - 实现搜索位置保存和恢复
  - _验证需求：9.2, 9.3, 9.4, 9.5, 9.7_

- [x] 11.1 编写关键词搜索属性测试


  - **Property 37: 关键词搜索完整性**
  - **验证需求：9.2**

- [x] 11.2 编写关键词搜索属性测试


  - **Property 38: 搜索结果列表完整性**
  - **验证需求：9.3**

- [x] 11.3 编写关键词搜索属性测试


  - **Property 39: 搜索结果跳转准确性**
  - **验证需求：9.4**

- [x] 11.4 编写关键词搜索属性测试


  - **Property 40: 搜索返回位置恢复**
  - **验证需求：9.5**

- [x] 12. 屏蔽词功能实现



  - 实现BlockedWordRepository接口
  - 实现屏蔽词CRUD操作
  - 实现applyBlockedWords方法（文本替换逻辑）
  - 在NovelRepository中集成屏蔽词过滤
  - _验证需求：10.2, 10.3, 10.4, 10.5_

- [x] 12.1 编写屏蔽词属性测试


  - **Property 42: 屏蔽词添加持久化**
  - **验证需求：10.2**

- [x] 12.2 编写屏蔽词属性测试


  - **Property 43: 屏蔽词删除一致性**
  - **验证需求：10.3**

- [x] 12.3 编写屏蔽词属性测试


  - **Property 44: 屏蔽词替换正确性**
  - **验证需求：10.4**

- [x] 12.4 编写屏蔽词属性测试


  - **Property 45: 屏蔽词设置即时生效**
  - **验证需求：10.5**

- [x] 13. 书签功能实现





  - 实现BookmarkRepository接口
  - 实现书签CRUD操作
  - 实现书签跳转逻辑
  - _验证需求：7.1, 7.2, 7.4, 7.5_

- [x] 13.1 编写书签属性测试


  - **Property 28: 书签保存完整性**
  - **验证需求：7.1, 7.2**

- [x] 13.2 编写书签属性测试


  - **Property 29: 书签跳转准确性**
  - **验证需求：7.4**

- [x] 13.3 编写书签属性测试


  - **Property 30: 书签删除一致性**
  - **验证需求：7.5**

- [ ] 14. AI服务实现



  - 实现AIService接口
  - 配置AI API（通义千问/文心一言/智谱AI）
  - 实现摘要生成Prompt构建
  - 实现API调用逻辑
  - 实现超时处理（30秒）
  - _验证需求：8.1, 8.3, 8.6_

- [x] 14.1 编写AI服务属性测试


  - **Property 31: AI摘要API调用正确性**
  - **验证需求：8.1**

- [x] 14.2 编写AI服务属性测试


  - **Property 33: AI服务错误处理**
  - **验证需求：8.3**

- [x] 14.3 编写AI服务属性测试


  - **Property 36: API超时处理正确性**
  - **验证需求：8.6**

- [x] 15. AIServiceRepository实现







  - 实现AIServiceRepository接口
  - 集成AIService
  - 实现摘要缓存逻辑
  - 实现批量生成摘要功能
  - _验证需求：8.2, 8.4, 8.5_

- [x] 15.1 编写AI Repository属性测试


  - **Property 32: AI摘要缓存正确性**
  - **验证需求：8.2**

- [x] 15.2 编写AI Repository属性测试


  - **Property 34: 摘要缓存命中避免重复调用**
  - **验证需求：8.4**

- [x] 15.3 编写AI Repository属性测试


  - **Property 35: 批量摘要生成顺序性**
  - **验证需求：8.5**

- [x] 16. 阅读统计功能实现



  - 实现StatisticsRepository接口
  - 实现阅读会话记录
  - 实现统计数据查询（按周期）
  - 实现阅读排行计算
  - _验证需求：12.1, 12.5, 12.6_

- [x] 16.1 编写阅读统计属性测试


  - **Property 50: 阅读时长记录正确性**
  - **验证需求：12.1**

- [x] 16.2 编写阅读统计属性测试


  - **Property 51: 阅读排行计算正确性**
  - **验证需求：12.5**

- [x] 16.3 编写阅读统计属性测试


  - **Property 52: 统计周期筛选正确性**
  - **验证需求：12.6**

- [x] 17. 语音朗读服务实现





  - 实现TTSService接口
  - 集成Android TextToSpeech API
  - 实现语音朗读控制（播放、暂停、停止）
  - 实现语速调节
  - 实现音色切换
  - 实现章节自动切换
  - 实现朗读位置保存和恢复
  - _验证需求：10.1, 10.2, 10.3, 10.4, 10.5, 10.6, 10.7_

- [x] 17.1 编写TTS属性测试


  - **Property 46: TTS启动正确性**
  - **验证需求：10.1**

- [x] 17.2 编写TTS属性测试


  - **Property 47: TTS暂停恢复一致性**
  - **验证需求：10.6, 10.7**

- [x] 17.3 编写TTS属性测试


  - **Property 48: TTS语速应用即时性**
  - **验证需求：10.3**

- [x] 17.4 编写TTS属性测试


  - **Property 49: TTS章节自动切换**
  - **验证需求：10.5**

- [x] 18. TTSRepository实现



  - 实现TTSRepository接口
  - 集成TTSService
  - 管理TTS状态
  - 实现可用音色列表获取
  - _验证需求：10.1, 10.2, 10.3, 10.4_

- [x] 19. 主题管理实现


  - 创建ReaderTheme类和预设主题
  - 实现主题持久化（SharedPreferences）
  - 实现自定义主题保存
  - 实现自动主题切换逻辑（基于时间）
  - _验证需求：6.1, 6.2, 6.5, 6.6_

- [x] 19.1 编写主题管理属性测试


  - **Property 25: 主题应用正确性**
  - **验证需求：6.2**

- [x] 19.2 编写主题管理属性测试



  - **Property 26: 自定义主题持久化**
  - **验证需求：6.5**

- [x] 19.3 编写主题管理属性测试


  - **Property 27: 自动主题切换正确性**
  - **验证需求：6.6**

- [x] 20. 设置管理实现







  - 实现SharedPreferences封装类
  - 实现字体大小、行间距设置
  - 实现主题设置
  - 实现自动切换设置
  - _验证需求：5.4, 5.5, 13.4_

- [x] 20.1 编写设置管理属性测试


  - **Property 21: 字体大小应用即时性**
  - **验证需求：5.4**

- [x] 20.2 编写设置管理属性测试


  - **Property 22: 行间距应用即时性**
  - **验证需求：5.5**

- [x] 20.3 编写设置管理属性测试


  - **Property 55: 设置持久化正确性**
  - **验证需求：13.4**

- [x] 21. 检查点 - 确保所有Repository和Service测试通过



  - 确保所有测试通过，如有问题请询问用户

- [x] 22. BookshelfViewModel实现





  - 创建BookshelfViewModel类
  - 实现小说列表加载
  - 实现搜索功能
  - 实现分类筛选
  - 实现小说删除
  - 管理BookshelfUiState
  - _验证需求：4.1, 4.4, 4.5, 4.6_

- [x] 23. ReaderViewModel实现





  - 创建ReaderViewModel类
  - 实现章节加载和切换
  - 实现阅读进度管理
  - 实现字体和行间距调整
  - 实现主题切换
  - 实现关键词搜索
  - 实现屏蔽词过滤
  - 实现阅读时长记录
  - 集成TTS语音朗读控制
  - 管理ReaderUiState
  - _验证需求：5.1, 5.4, 5.5, 5.6, 5.7, 6.2, 9.2, 10.1, 10.2, 11.4_

- [x] 24. ParserViewModel实现





  - 创建ParserViewModel类
  - 实现URL输入和验证
  - 实现小说元数据解析
  - 实现章节列表解析
  - 实现小说下载
  - 实现下载进度管理
  - 管理ParserUiState
  - _验证需求：2.1, 2.2, 2.3, 2.4_

- [x] 25. SettingsViewModel实现





  - 创建SettingsViewModel类
  - 实现主题管理
  - 实现阅读设置管理
  - 实现解析规则管理
  - 实现屏蔽词管理
  - _验证需求：3.1, 6.1, 11.1_

- [x] 26. StatisticsViewModel实现



  - 创建StatisticsViewModel类
  - 实现统计数据加载
  - 实现周期切换
  - 实现图表数据准备
  - _验证需求：12.2, 12.6_

- [x] 27. 书架界面实现





  - 创建BookshelfActivity和布局XML
  - 实现RecyclerView显示小说列表
  - 实现小说条目布局（封面、标题、作者、进度）
  - 实现搜索框
  - 实现分类筛选
  - 实现长按菜单（删除、编辑、置顶）
  - 实现导入按钮（本地文件、网站URL）
  - _验证需求：4.1, 4.2, 4.3, 4.5, 4.6_

- [x] 28. 阅读器界面实现





  - 创建ReaderActivity和布局XML
  - 实现ScrollView显示章节内容
  - 实现点击显示/隐藏工具栏
  - 实现顶部工具栏（返回、章节列表、搜索、书签、朗读）
  - 实现底部工具栏（上一章、下一章、进度条、设置）
  - 实现章节切换动画
  - _验证需求：5.1, 5.2, 5.3, 5.6_

- [ ] 29. 语音朗读界面实现
  - 在阅读器工具栏添加朗读按钮
  - 创建TTSControlDialog（播放控制面板）
  - 实现播放/暂停/停止按钮
  - 实现语速调节SeekBar
  - 实现音色选择Spinner
  - 实现朗读进度显示
  - _验证需求：10.1, 10.2, 10.3, 10.4_

- [x] 30. 阅读设置界面实现





  - 创建ReaderSettingsDialog
  - 实现字体大小调节SeekBar
  - 实现行间距调节SeekBar
  - 实现主题选择（日间、夜间、护眼、自定义）
  - 实现自动切换开关
  - _验证需求：5.4, 5.5, 6.1, 6.2, 6.3, 6.4, 6.6_

- [x] 31. 搜索功能界面实现





  - 创建SearchDialog
  - 实现搜索输入框
  - 实现搜索结果RecyclerView
  - 实现结果跳转
  - 实现上一个/下一个导航
  - 实现返回原位置
  - _验证需求：9.1, 9.3, 9.4, 9.5, 9.7_

- [ ] 32. 书签界面实现
  - 创建BookmarkActivity和布局XML
  - 实现书签列表RecyclerView
  - 实现添加书签Dialog（带备注输入）
  - 实现书签跳转
  - 实现书签删除
  - _验证需求：7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 33. 网站解析界面实现
  - 创建WebParserActivity和布局XML
  - 实现URL输入框
  - 实现解析规则选择Spinner
  - 实现解析按钮和进度显示
  - 实现章节列表预览
  - 实现下载按钮和进度条
  - 实现取消下载功能
  - _验证需求：2.1, 2.2, 2.3, 2.4, 2.5, 14.6_

- [ ] 34. 解析规则管理界面实现
  - 创建ParserRuleActivity和布局XML
  - 实现规则列表RecyclerView
  - 实现添加/编辑规则Dialog
  - 实现规则字段输入（域名、选择器）
  - 实现规则测试功能
  - 实现规则删除
  - _验证需求：3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

- [ ] 35. 屏蔽词管理界面实现
  - 创建BlockedWordActivity和布局XML
  - 实现屏蔽词列表RecyclerView
  - 实现添加屏蔽词Dialog
  - 实现屏蔽词删除
  - _验证需求：11.1, 11.2, 11.3_

- [ ] 36. AI摘要功能界面实现
  - 在章节列表中添加"生成摘要"按钮
  - 实现摘要显示Dialog
  - 实现批量生成进度显示
  - 实现错误提示和重试
  - _验证需求：8.1, 8.2, 8.3, 8.5_

- [ ] 37. 阅读统计界面实现
  - 创建StatisticsActivity和布局XML
  - 实现总时长和总字数显示
  - 使用MPAndroidChart实现图表（每日时长、时段分布）
  - 实现周期切换（日、周、月）
  - 实现阅读排行列表
  - _验证需求：12.2, 12.3, 12.4, 12.5, 12.6_

- [x] 38. 文件导入功能集成





  - 实现文件选择器调用
  - 实现导入进度显示
  - 实现导入成功/失败提示
  - _验证需求：1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 39. 导航和路由实现
  - 实现Activity间导航
  - 实现数据传递（小说ID、章节ID等）
  - 实现返回栈管理
  - _验证需求：所有UI相关需求_

- [ ] 40. 错误处理和用户提示
  - 实现全局错误处理
  - 实现Toast和Snackbar提示
  - 实现加载状态显示（ProgressBar）
  - 实现网络错误提示
  - _验证需求：1.4, 2.5, 8.3, 14.2, 14.3, 14.4_

- [ ] 41. 权限管理
  - 实现文件读取权限请求
  - 实现网络权限配置
  - 实现权限拒绝处理
  - _验证需求：1.1, 2.1_

- [ ] 42. 性能优化
  - 实现RecyclerView ViewHolder优化
  - 实现图片加载优化（Glide/Coil）
  - 实现数据库查询优化
  - 实现内存泄漏检查
  - _验证需求：性能考虑部分_

- [ ] 43. 最终检查点 - 端到端测试
  - 确保所有测试通过，如有问题请询问用户

